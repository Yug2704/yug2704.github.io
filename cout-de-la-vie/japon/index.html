<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CoÃ»t de la vie au Japon en 2025 : tous les prix</title>
  <meta name="description" content="Prix moyens au Japon et comparaison avec la France : restaurant, boissons, loyer, salaire, etc. DonnÃ©es mises Ã  jour.">
  <meta property="og:title" content="CoÃ»t de la vie au Japon en 2025" />
  <meta property="og:description" content="Comparatif avec la France et prix dÃ©taillÃ©s par panier de biens et services." />
  <link rel="canonical" href="." />
  <link rel="stylesheet" href="/assets/css/site.css" />

  <!-- Styles spÃ©cifiques banniÃ¨re + intro -->
  <style>
    .hero-banner{
      width:100%;
      height:260px;                 /* ajuste Ã  300â€“340px si tu veux plus dâ€™impact */
      background-size:cover;
      background-position:center;
      border-radius:14px;
      margin:14px auto 18px;
      box-shadow:0 1px 0 rgba(0,0,0,.03) inset;
    }
    @media (min-width: 900px){ .hero-banner{ height:300px; } }

    .country-intro{
      background:#fff;
      border:1px solid var(--line,#e5e7eb);
      border-radius:12px;
      padding:18px;
      margin-top:10px;
    }
    .country-intro p{ margin:0 0 10px; line-height:1.55; }
    .country-intro ul{ margin:8px 0 4px 18px; }
    .country-intro li{ margin:6px 0; }
    .country-intro .muted{ color:var(--muted,#64748b); font-size:.95rem; }
    .country-intro .pill{
      display:inline-block; font-weight:600; padding:.1rem .5rem; border-radius:999px;
      background:#f1f5f9; border:1px solid #e2e8f0; margin-left:.25rem;
    }
    .delta-ok{ color:#0a7f3f; }
    .delta-bad{ color:#b42318; }
  </style>

  <script>
    // util: charge un fragment HTML
    async function include(selector, url){
      const el = document.querySelector(selector);
      const res = await fetch(url,{cache:'no-store'});
      el.outerHTML = await res.text();
    }
    // util: format prix
    const fmtEUR = (n)=> (Math.round(n*100)/100).toLocaleString('fr-FR',{minimumFractionDigits: (Number.isInteger(n)?0:2)}) + " â‚¬";
    // util: % Ã©cart
    function pctDiff(v, ref){
      if (!ref || ref===0) return null;
      const p = Math.round(((v - ref)/ref)*100);
      return {p, label: p===0 ? "identique" : (p<0 ? `${Math.abs(p)}% de moins` : `${p}% de plus`), cls: (p<=0?'ok':'bad')};
    }
    // map libellÃ©s
    const LABELS = {
      "dejeuner_restaurant": ["DÃ©jeuner","Prix dâ€™un repas au restaurant"],
      "diner_3plats": ["DÃ®ner 3 plats","Prix dâ€™un dÃ®ner au restaurant (3 plats)"],
      "menu_fastfood": ["Menu McDo / fast-food","Prix dâ€™un menu chez McDonaldâ€™s (ou Ã©quivalent)"],
      "biere_locale_05": ["BiÃ¨re locale (0,5 L)","Prix dâ€™une biÃ¨re pression (0,5 L)"],
      "biere_etrangere_033": ["BiÃ¨re Ã©trangÃ¨re (0,33 L)","Prix dâ€™une biÃ¨re en bouteille (0,33 L)"],
      "cappuccino": ["Cappuccino","Prix dâ€™une tasse de cappuccino"],
      "soda_canette": ["Soda (canette)","Prix dâ€™une canette de soda"],
      "eau_petite": ["Bouteille dâ€™eau (petite)","Prix dâ€™une petite bouteille dâ€™eau"]
    };

    // BanniÃ¨res par pays (fallback gÃ©nÃ©rique)
    const HERO_IMAGES = {
      "japon": "https://upload.wikimedia.org/wikipedia/commons/0/0e/Mount_Fuji_banner_Fuji_and_cherry_blossoms.png"
    };
    const HERO_FALLBACK = "https://upload.wikimedia.org/wikipedia/commons/0/0e/Mount_Fuji_banner_Fuji_and_cherry_blossoms.png";
  </script>
</head>
<body>
  <!-- Header partagÃ© -->
  <div id="header-placeholder"></div>

  <main>
    <!-- ===== BANNIÃˆRE LARGE ===== -->
    <section class="hero-banner" id="hero-banner" role="img" aria-label="Paysage du Japon"></section>

    <section class="page-hero">
      <div class="container">
        <nav aria-label="Fil dâ€™Ariane" class="muted" style="font-size:13px">
          <a href="/">Accueil</a> â€º <a href="/cout-de-la-vie/">CoÃ»t de la vie</a> â€º <span id="crumb-name">Japon</span>
        </nav>
        <h1 id="page-title">CoÃ»t de la vie au Japon en 2025 : tous les prix</h1>

        <!-- Accroche chiffrÃ©e (inspirÃ©e de Combien-coÃ»te) -->
        <div class="country-intro" id="intro-rich">
          <!-- contenu injectÃ© dynamiquement -->
        </div>
      </div>
    </section>

    <section class="container">
      <!-- Ton rÃ©sumÃ© existant est conservÃ© -->
      <div class="summary" id="summary">
        <div class="badge" id="headline"></div>
        <ul class="bullets" id="bullets"></ul>
        <small class="muted">ðŸ•’ DerniÃ¨re mise Ã  jour : <span id="last-update">â€”</span></small>
      </div>

      <div class="cards" id="cards"></div>
    </section>
  </main>

  <!-- Footer partagÃ© -->
  <div id="footer-placeholder"></div>

  <script>
    // Injecte header/footer
    include('#header-placeholder','/partials/header.html');
    include('#footer-placeholder','/partials/footer.html');

    // Lit le slug depuis lâ€™URL (/cout-de-la-vie/<slug>/)
    const slug = location.pathname.replace(/\/$/,'').split('/').pop() || 'japon';

    function setHero(slugVal){
      const url = HERO_IMAGES[slugVal] || HERO_FALLBACK;
      const hero = document.getElementById('hero-banner');
      hero.style.backgroundImage = `url("${url}")`;
    }

    function buildIntro(node, ref){
      // DonnÃ©es utilisÃ©es pour lâ€™accroche
      const delta = (node.headline && typeof node.headline.delta_vs_france_pct === 'number')
        ? node.headline.delta_vs_france_pct : null;

      const dej = node.meta?.dejeuner_moins_cher ?? node.basket?.dejeuner_restaurant ?? null;
      const cine = node.meta?.place_de_cinema ?? null;
      const loyer = node.meta?.loyer_centre_ville_50m2 ?? null;
      const sal = node.meta?.salaire_mensuel_net ?? null;

      // Comparatifs si on a la France
      const baseDej = ref?.basket?.dejeuner_restaurant ?? null;
      const dDej = (baseDej!=null && dej!=null) ? pctDiff(dej, baseDej) : null;

      const parts = [];
      // Paragraphe dâ€™intro
      parts.push(`<p>DÃ©couvrez le coÃ»t de la vie au <strong>${node.name}</strong> en 2025&nbsp;: logement, nourriture, transport, loisirsâ€¦
      Comparez directement avec la France et explorez les diffÃ©rences entre Tokyo, Osaka ou Kyoto${delta!==null ? `.<span class="pill ${delta<=0?'delta-ok':'delta-bad'}">${delta>0?`+${delta}%`:`${delta}%`} vs France (moyenne)</span>` : ''}</p>`);

      // Liste dâ€™accroche chiffrÃ©e
      const lines = [];
      if (dej!=null) lines.push(`Un dÃ©jeuner au restaurant&nbsp;: <strong>${fmtEUR(dej)}</strong>${dDej?` â€“ ${dDej.label} vs France`:''}`);
      if (cine!=null) lines.push(`Une place de cinÃ©ma&nbsp;: <strong>${fmtEUR(cine)}</strong>`);
      if (loyer!=null) lines.push(`Loyer ~50&nbsp;mÂ² en centre-ville&nbsp;: <strong>${fmtEUR(loyer)}</strong> / mois`);
      if (sal!=null) lines.push(`Salaire mensuel net moyen&nbsp;: <strong>${fmtEUR(sal)}</strong>`);
      if (lines.length){
        parts.push(`<ul>${lines.map(x=>`<li>${x}</li>`).join('')}</ul>`);
      }
      parts.push(`<p class="muted">Ces valeurs sont des ordres de grandeur issus de ta base (mises Ã  jour automatiquement). Elles peuvent varier selon la ville et le quartier.</p>`);
      return parts.join('');
    }

    async function bootstrap(){
      setHero(slug);

      const res = await fetch('/data/locations.json',{cache:'no-store'});
      const db = await res.json();

      const node = db[slug];
      if(!node){ document.getElementById('page-title').textContent = "Lieu introuvable"; return; }

      // Contexte FR de comparaison
      const ref = node.compare_to ? db[node.compare_to] : db['france'];

      // SEO/Title dynamiques
      const isCountry = node.type === 'country';
      const title = `CoÃ»t de la vie ${isCountry?'au':'Ã '} ${node.name} en 2025 : tous les prix`;
      document.title = title;
      document.getElementById('page-title').textContent = title;
      document.getElementById('crumb-name').textContent = node.name;

      // Accroche chiffrÃ©e sous le titre
      document.getElementById('intro-rich').innerHTML = buildIntro(node, ref);

      // Headline
      const head = document.getElementById('headline');
      if (node.headline && typeof node.headline.delta_vs_france_pct === 'number'){
        const d = node.headline.delta_vs_france_pct;
        head.textContent = (d>=0?`+${d}%`:`${d}%`) + " vs France (moyenne)";
      } else {
        head.textContent = "Comparatif avec la France";
      }

      // Bullets de rÃ©sumÃ© (section existante)
      const bullets = document.getElementById('bullets');
      bullets.innerHTML = "";
      const items = [];
      if (node.meta?.salaire_mensuel_net) items.push(`Le salaire mensuel net est de : <strong>${fmtEUR(node.meta.salaire_mensuel_net)}</strong>`);
      if (node.meta?.dejeuner_moins_cher) items.push(`Un dÃ©jeuner au restaurant : <strong>${fmtEUR(node.meta.dejeuner_moins_cher)}</strong>`);
      if (node.meta?.place_de_cinema) items.push(`Le prix dâ€™une place de cinÃ©ma est de <strong>${fmtEUR(node.meta.place_de_cinema)}</strong>`);
      if (node.meta?.loyer_centre_ville_50m2) items.push(`La location dâ€™un 50 mÂ² en centre-ville coÃ»te <strong>${fmtEUR(node.meta.loyer_centre_ville_50m2)}</strong>`);
      if (node.headline?.resume) items.unshift(node.headline.resume);
      bullets.innerHTML = items.map(x=>`<li>${x}</li>`).join("");

      // Date MAJ
      const last = node.last_update || new Date().toLocaleDateString('fr-FR');
      document.getElementById('last-update').textContent = last;
      window.__pageLastUpdate = last;

      // Cartes
      const cards = document.getElementById('cards');
      cards.innerHTML = "";
      const order = ["dejeuner_restaurant","diner_3plats","menu_fastfood","biere_locale_05","biere_etrangere_033","cappuccino","soda_canette","eau_petite"];
      order.forEach(key=>{
        if(!(key in node.basket)) return;
        const [title, subtitle] = LABELS[key] || [key,key];
        const val = node.basket[key];
        const base = ref?.basket?.[key];
        const diff = (base!=null) ? pctDiff(val, base) : null;

        const el = document.createElement('article');
        el.className = 'card';
        el.innerHTML = `
          <div class="card-head">${title}</div>
          <div class="card-body">
            <div class="price">${fmtEUR(val)}</div>
            <div class="sub">${subtitle} en ${node.name} (2025)</div>
            ${
              (base!=null && diff) ?
              `<div class="delta ${diff.cls}">â†³ ${diff.label} (France : ${fmtEUR(base)})</div>`
              : ``
            }
          </div>`;
        cards.appendChild(el);
      });
    }
    bootstrap();
  </script>
</body>
</html>
