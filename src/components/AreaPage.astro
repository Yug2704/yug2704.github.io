---
import BaseLayout from "../layouts/BaseLayout.astro";
import frBase from "../data/countries/france.json"; // base de comparaison (France)

const { data } = Astro.props; // JSON de la zone (pays OU ville)

// Libell√©s -> cl√©s JSON
const FIELDS = [
  ["üçΩÔ∏è Repas au restaurant", "repas"],
  ["‚òï Caf√©", "caf√©"],
  ["ü•ñ Pain", "pain"],
  ["üè† Loyer (1 ch. centre-ville)", "loyer"],
  ["üöå Transport (ticket)", "transport"],
  ["üé¨ Cin√©ma (1 place)", "cin√©ma"],
  ["üö¨ Cigarettes (20)", "cigarettes"],
];

// Pr√©pare les lignes (aucun JSX ici)
function makeRow(label, key) {
  const v = data?.prices?.[key];
  if (v == null) return null;

  const vf = frBase?.prices?.[key];
  let deltaTxt = "";
  if (vf != null && Number(vf) !== 0) {
    const pct = ((Number(v) - Number(vf)) / Number(vf)) * 100;
    const sens =
      pct === 0
        ? "identique"
        : pct > 0
        ? `${Math.abs(pct).toFixed(0)}% plus cher`
        : `${Math.abs(pct).toFixed(0)}% moins cher`;
    deltaTxt = `France : ${vf} ${frBase.currency || ""} ‚Äî ${sens}`;
  }

  return {
    label,
    value: v,
    unit: data.currency || "",
    deltaTxt
  };
}

const rows = FIELDS.map(([label, key]) => makeRow(label, key)).filter(Boolean);
---

<BaseLayout
  title={`Co√ªt de la vie √† ${data.name} (${data.country})`}
  description={`Prix √† ${data.name} : repas, logement, transport, etc. Comparaison avec la France.`}
>
  {data.banner && (
    <div style="margin:12px 0 20px 0;border-radius:14px;overflow:hidden;max-height:220px">
      <img src={data.banner} alt={`Banni√®re ${data.country}`} style="width:100%;height:auto;display:block" loading="lazy" />
    </div>
  )}

  <section>
    <h1 style="margin:0 0 12px 0;">{data.name} ‚Äî Compar√© √† la France</h1>
    <p style="background:#fff1f6;border:1px solid #ffd0df;border-radius:12px;padding:12px;margin:0 0 16px 0">
      Aper√ßu des co√ªts moyens avec comparaison directe √† la r√©f√©rence France.
      Les valeurs peuvent varier selon la zone.
    </p>

    <div class="card" style="margin:16px 0;">
      <h3 style="margin-top:0;">Chiffres cl√©s (vs France)</h3>
      <table style="width:100%;border-collapse:collapse">
        <tbody>
          {rows.map((r) => (
            <tr>
              <td style="padding:8px;border-bottom:1px solid #e5e7eb">{r.label}</td>
              <td style="padding:8px;border-bottom:1px solid #e5e7eb;text-align:right">
                {r.value} {r.unit}
                {r.deltaTxt && (
                  <div style="font-size:.85rem;color:#6b7280">{r.deltaTxt}</div>
                )}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>

    {data.summary && (
      <div class="card" style="margin:16px 0;">
        <h3 style="margin-top:0;">√Ä savoir sur {data.name}</h3>
        <p style="color:#4b5563;margin:0">{data.summary}</p>
      </div>
    )}

    <p style="color:#6b7280;font-size:.9rem">Derni√®re mise √† jour : {data.last_update}</p>
  </section>
</BaseLayout>
