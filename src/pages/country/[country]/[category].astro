---
import BaseLayout from "../../../layouts/BaseLayout.astro";

// mapping minimal
const keyByCategory: Record<string, string> = {
  restaurant: "restaurant",
  salaire: "salaireNet",
  loyer: "loyer",
  essence: "essence",
  cinema: "cinema",
  hotel: "hotel",
  habiter: "habiterIndex",
};

export async function getStaticPaths() {
  // charge uniquement FR
  const countryFiles = import.meta.glob("../../../data/countries/*.json", { eager: true }) as Record<string, any>;
  const COUNTRIES = Object.values(countryFiles).map((m: any) => m?.default ?? m);
  const FR = COUNTRIES.find((c: any) => c?.slug === "france");
  if (!FR) return [];

  // NE GÉNÈRE QU’UNE ROUTE POUR TESTER
  return [{
    params: { country: "france", category: "restaurant" },
    props:  { country: FR, category: "restaurant", FR }
  }];
}

const { country, category, FR } =
  Astro.props as { country: any; category: string; FR: any };

// affichage minimal
const val = country?.kpis?.restaurant ?? null;
const ref = FR?.kpis?.restaurant ?? null;
---
<BaseLayout title={`Test ${category} – ${country?.name}`}>
  <pre>country: {country?.slug}</pre>
  <pre>category: {category}</pre>
  <pre>val: {String(val)}</pre>
  <pre>ref: {String(ref)}</pre>
</BaseLayout>
